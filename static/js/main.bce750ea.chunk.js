(this["webpackJsonppdf-editor"]=this["webpackJsonppdf-editor"]||[]).push([[0],{26:function(e,t,n){e.exports={toolbar:"Toolbar_toolbar__1pnoi",group:"Toolbar_group__3Bx_F",text:"Toolbar_text__1k5cZ"}},28:function(e,t,n){e.exports={overlay:"Overlay_overlay__K05mY",item:"Overlay_item__1Uqku",selected:"Overlay_selected__3ljIr"}},33:function(e,t,n){e.exports={screenViewport:"PdfEditor_screenViewport__2ZHEP",editorArea:"PdfEditor_editorArea__3RcQj",pdfViewportArea:"PdfEditor_pdfViewportArea__3dnYL"}},36:function(e,t,n){e.exports={dropzone:"PdfLoader_dropzone__1u5la",inner:"PdfLoader_inner__3auJD"}},38:function(e,t,n){e.exports={viewport:"PdfViewport_viewport__3V6dn",page:"PdfViewport_page__1uGEO"}},70:function(e,t,n){e.exports=n(89)},75:function(e,t,n){},76:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),o=n(47),c=n.n(o),i=(n(75),n(76),n(9)),u=Object(a.createContext)({data:null,setData:function(){},isFileLoaded:function(){}}),l=function(e){var t=e.children,n=Object(a.useState)(null),o=Object(i.a)(n,2),c=o[0],l=o[1];console.log("[file-context] file data:",c);return r.a.createElement(u.Provider,{value:{data:c,setData:l,isFileLoaded:function(){return null!==c}}},t)},s=Object(a.createContext)({scale:1,setScale:function(){},resetScale:function(){},fontSize:12,setFontSize:function(){}}),d=function(e){var t=e.children,n=Object(a.useState)(1),o=Object(i.a)(n,2),c=o[0],u=o[1],l=Object(a.useState)(12),d=Object(i.a)(l,2),f=d[0],p=d[1];return r.a.createElement(s.Provider,{value:{scale:c,setScale:u,resetScale:function(){return u(1)},fontSize:f,setFontSize:p}},t)},f=Object(a.createContext)({counter:2,resetCounter:function(){},incrementCounter:function(){},decrementCounter:function(){}}),p=function(e){var t=e.children,n=Object(a.useState)(2),o=Object(i.a)(n,2),c=o[0],u=o[1];return r.a.createElement(f.Provider,{value:{counter:c,resetCounter:function(){return u(2)},incrementCounter:function(){return u((function(e){return e+1}))},decrementCounter:function(){return u((function(e){return e-1}))}}},t)},m=n(8),v=n.n(m),b=n(11),h=n(48),g=n(25),j=n(65),O=n(29),y=n(68),x=[],E=Object(a.createContext)({modList:x,resetModList:function(){},addMod:function(){},changeMod:function(e,t){},removeMod:function(e){}}),C=function(e){var t=e.children,n=Object(a.useState)(x),o=Object(i.a)(n,2),c=o[0],u=o[1],l=Object(a.useState)(0),s=Object(i.a)(l,2),d=s[0],f=s[1];return r.a.createElement(E.Provider,{value:{modList:c,resetModList:function(){u(x),f(0)},addMod:function(e){return f((function(e){return e+1})),u((function(t){return[].concat(Object(y.a)(t),[Object(O.a)({},e,{id:d})])}))},changeMod:function(e,t){var n=c.map((function(n){return n.id!==e?n:t(n)}));u(n)},removeMod:function(e){var t=c.filter((function(t){return t.id!==e})).map((function(t){return t.id<e?t:Object(O.a)({},t,{value:t.value-1})}));u(t)}}},t)},w=function(e){return(e%360+360)%360};function k(e,t,n,a,r){switch(e){case 0:return{x:t,y:n};case 90:return{x:n,y:r-t};case 180:return{x:a-t,y:r-n};case 270:return{x:a-n,y:t}}}function _(){return(_=Object(b.a)(v.a.mark((function e(t,n,a){var r,o,c,u,l,s,d,f,p,m,b,O,y,x;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.PDFDocument.load(t);case 2:return r=e.sent,o="".concat("/PdfEditor","/fonts/Roboto/Roboto-Regular.ttf"),r.registerFontkit(j.a),e.next=7,fetch(o).then((function(e){return e.arrayBuffer()}));case 7:return c=e.sent,console.log("font loaded: ",c),e.next=11,r.embedFont(c);case 11:return u=e.sent,l=r.getPages(),s=Object(i.a)(l,1),d=s[0],f=d.getSize(),p=f.width,m=f.height,b=d.getRotation().angle,O=w(b),console.log("original: ".concat(b," angle: ").concat(O)),n.forEach((function(e){var t=k(O,e.position.x-a/2,e.position.y+a/2,p,m);d.drawText(e.template(e.value),{x:t.x,y:m-t.y,rotate:Object(g.degrees)(O),size:a,font:u,color:Object(g.rgb)(0,0,1)})})),e.next=20,r.save();case 20:y=e.sent,x=new Blob([y],{type:"application/pdf"}),console.log("request to download file accepted",x),Object(h.saveAs)(x,"output.pdf");case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=Object(b.a)(v.a.mark((function e(t,n,a){var r,o,c,u,l,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.PDFDocument.load(t);case 2:return r=e.sent,o=r.getPages(),c=Object(i.a)(o,1),u=c[0],l=u.getRotation().angle,u.setRotation(Object(g.degrees)(l+a)),e.next=8,r.save();case 8:s=e.sent,n(s);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(e){var t=e.children,n=Object(a.useContext)(u),r=n.data,o=n.isFileLoaded,c=n.setData,i=Object(a.useContext)(s),l=i.scale,d=i.setScale,p=i.fontSize,m=i.setFontSize,v=Object(a.useContext)(f),b=v.counter,h=v.resetCounter,g=Object(a.useContext)(E),j=g.modList,O=g.resetModList;return t({disabled:!1===o(),scale:l,onZoomChange:function(e){return d((function(t){return t+e}))},onRotate:function(e){if(0!==j.length&&!1===window.confirm("Warning: all changes will be lost"))return;!function(e,t,n){S.apply(this,arguments)}(r,c,e),O(),h()},counter:b,onDownload:function(){return function(e,t,n){return _.apply(this,arguments)}(r,j,p)},fontSize:p,setFontSize:m})},z=n(26),L=n.n(z);var P=function(e){var t=e.disabled,n=e.scale,a=e.counter,o=e.onZoomChange,c=e.onRotate,i=e.onDownload,u=e.onLoad,l=e.fontSize,s=e.setFontSize,d=t?null:r.a.createElement("div",{className:L.a.text},"Place next running label: ","{".concat(a,"}"));return r.a.createElement("div",{className:L.a.toolbar},r.a.createElement("div",{className:L.a.group},r.a.createElement("button",{disabled:t,onClick:function(){return o(.1)}},"+"),r.a.createElement("button",{disabled:t,onClick:function(){return o(-.1)}},"-"),r.a.createElement("input",{type:"text",disabled:!0,value:"".concat((100*n).toFixed(0),"%")})),r.a.createElement("div",{className:L.a.group},r.a.createElement("button",{disabled:t,onClick:function(){return c(-90)}},"Left"),r.a.createElement("label",null,"Rotate"),r.a.createElement("button",{disabled:t,onClick:function(){return c(90)}},"Right")),r.a.createElement("div",{className:L.a.group},r.a.createElement("input",{type:"number",title:"Font size",value:l,onChange:function(e){var t=e.target.value,n=/^\d+(\.\d)?$/.test(t);if(e.target.validity.valid&&n){var a=parseFloat(t);s(function(e){return Math.round(2*e)/2}(a))}},disabled:t,min:"1",max:"400",step:"any"})),r.a.createElement("button",{disabled:t,onClick:u},"Load"),r.a.createElement("button",{disabled:t,onClick:i},"Download"),d)};var F=function(e){var t=e.children,n=Object(a.useState)(!0),r=Object(i.a)(n,2),o=r[0],c=r[1],l=Object(a.useContext)(u),d=l.isFileLoaded,p=l.setData,m=Object(a.useContext)(s).resetScale,v=Object(a.useContext)(f).resetCounter,b=Object(a.useContext)(E).resetModList;return t({showDialog:o,openDialog:function(){return c(!0)},closeDialog:function(){return c(!1)},onLoad:function(e){c(!1),p(e),m(),v(),b()},isAtReload:function(){return d()&&o}})},M=n(13),N=n(14),R=n(16),A=n(15),I=n(66),V=n.n(I),B=n(36),K=n.n(B),T=function(e){Object(R.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(M.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onFilesChange=function(){var t=Object(b.a)(v.a.mark((function t(n){var a,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("got request to load files:",n),a=n[0],t.next=4,a.arrayBuffer();case 4:r=t.sent,console.log("data:",r),e.props.onLoad(r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onFilesError=function(e,t){console.warn("error loading files ".concat(t,". error:"),e)},e}return Object(N.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:K.a.dropzone},r.a.createElement(V.a,{className:K.a.inner,onChange:this.onFilesChange,onError:this.onFilesError,accepts:[".pdf"],clickable:!0,maxFiles:1},"Drop a file here or click to upload"))}}]),n}(a.Component),U=n(32);function W(e){return U.a.getDocument(e).promise}var Y=function(e){Object(R.a)(n,e);var t=Object(A.a)(n);function n(e){var a;return Object(M.a)(this,n),(a=t.call(this,e)).state={docObj:null,data:e.data},a}return Object(N.a)(n,[{key:"componentDidMount",value:function(){var e=Object(b.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(this.props.data);case 2:t=e.sent,this.setState({docObj:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(b.a)(v.a.mark((function e(t,n){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.data===t.data){e.next=6;break}return console.log("[PdfDoc] updating doc object"),e.next=4,W(this.props.data);case 4:a=e.sent,this.setState({docObj:a,data:this.props.data});case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.children;return null!==this.state.docObj?e(this.state.docObj):null}}]),n}(a.Component);function Z(e,t){return e.getPage(t)}var q=function(e){Object(R.a)(n,e);var t=Object(A.a)(n);function n(e){var a;return Object(M.a)(this,n),(a=t.call(this,e)).state={pageObj:null},a}return Object(N.a)(n,[{key:"componentDidMount",value:function(){var e=Object(b.a)(v.a.mark((function e(){var t,n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.document,a=t.pageNum,e.next=3,Z(n,a);case 3:r=e.sent,this.setState({pageObj:r});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(b.a)(v.a.mark((function e(t,n){var a,r,o,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.props,r=a.document,o=a.pageNum,r===t.document&&o===t.pageNum){e.next=6;break}return e.next=4,Z(r,o);case 4:c=e.sent,this.setState({pageObj:c});case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.children;return null!==this.state.pageObj?e(this.state.pageObj):null}}]),n}(a.Component);function J(e,t,n){var a=t.getViewport({scale:n});e.width=a.width,e.height=a.height,t.render({canvasContext:e.getContext("2d"),viewport:a})}var G=function(e){Object(R.a)(n,e);var t=Object(A.a)(n);function n(e){var a;return Object(M.a)(this,n),(a=t.call(this,e)).getMousePos=function(e,t){var n=a.canvasRef.current.getBoundingClientRect();return{x:e-n.left,y:t-n.top}},a.canvasRef=r.a.createRef(),a}return Object(N.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.page,n=e.scale;J(this.canvasRef.current,t,n)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.page,a=t.scale;n===e.page&&a===e.scale||J(this.canvasRef.current,n,a)}},{key:"render",value:function(){var e=this,t=this.props.onClick;return r.a.createElement("canvas",{ref:this.canvasRef,onClick:function(n){return t(n,e.getMousePos(n.clientX,n.clientY))},style:{cursor:"crosshair"}})}}]),n}(a.Component),X=n(67),$=n.n(X),H=n(69),Q=n(28),ee=n.n(Q);var te=r.a.memo((function(e){var t=e.position,n=e.size,a=e.value,o=e.scale,c=e.template,i=e.isSelected,u=Object(H.a)(e,["position","size","value","scale","template","isSelected"]);return r.a.createElement("div",Object.assign({className:"".concat(ee.a.item," ").concat(i?ee.a.selected:""),style:{left:"".concat((t.x-n/2)*o,"px"),top:"".concat((t.y-n/2)*o,"px"),fontSize:"".concat(n*o,"px")},draggable:i,title:i?"Press <Delete> to remove this":null},u),c(a))}));var ne=function(e){var t=e.items,n=e.scale,o=e.onItemMove,c=e.onItemDelete,u=e.fontSize,l=Object(a.useRef)(null),s=Object(a.useState)(null),d=Object(i.a)(s,2),f=d[0],p=d[1];return Object(a.useEffect)((function(){0===t.length&&p(null)}),[t]),r.a.createElement("div",{ref:l,className:ee.a.overlay,style:{position:null!==f?"absolute":null},onClick:function(){p(null)}},r.a.createElement($.a,{handleKeys:["delete"],handleEventType:"keyup",onKeyEvent:function(){null!==f&&(c(f),p(null))}}),t.map((function(e){return r.a.createElement(te,{key:e.id,position:e.position,size:u,value:e.value,scale:n,template:e.template,onDragEnd:function(t){return o(t,function(e,t){var n=e.getBoundingClientRect(),a=n.left,r=n.top;return{x:t.clientX-a,y:t.clientY-r}}(l.current,t),e.id)},isSelected:e.id===f,onClick:function(t){p(e.id),t.stopPropagation()}})})))},ae=n(38),re=n.n(ae);var oe=function(e){var t=e.data,n=e.pageNum,a=e.scale,o=e.overlayItems,c=e.className,i=void 0===c?"":c,u=e.style,l=e.onClick,s=e.onItemMove,d=e.onItemDelete,f=e.fontSize;return r.a.createElement("div",{className:"".concat(i," ").concat(re.a.viewport),style:u},r.a.createElement("div",{className:re.a.page},null!==t?r.a.createElement(Y,{data:t},(function(e){return r.a.createElement(q,{document:e,pageNum:n},(function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne,{items:o,scale:a,onItemMove:s,onItemDelete:d,fontSize:f}),r.a.createElement(G,{page:e,scale:a,onClick:l}))}))})):null))};var ce=function(e){var t=e.children,n=Object(a.useContext)(u).data,r=Object(a.useContext)(s),o=r.scale,c=r.fontSize,i=Object(a.useContext)(f),l=i.counter,d=i.incrementCounter,p=i.decrementCounter,m=Object(a.useContext)(E),v=m.modList,b=m.addMod,h=m.changeMod,g=m.removeMod;return t({data:n,pageNum:1,scale:o,overlayItems:v,onClick:function(e,t){return function(e,t,n,a,r){a({position:{x:n.x/e,y:n.y/e},value:t,template:function(e){return"(".concat(e,")")}}),r()}(o,l,t,b,d)},onItemMove:function(e,t,n){h(n,(function(e){return Object(O.a)({},e,{position:{x:t.x/o,y:t.y/o}})}))},onItemDelete:function(e){g(e),p()},fontSize:c})},ie=function(e){Object(R.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(M.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onKeyup=function(t){["Escape","Esc"].includes(t.key)&&e.props.onClick()},e}return Object(N.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.onKeyup,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.onKeyup,!1)}},{key:"render",value:function(){return null}}]),n}(a.Component),ue=n(33),le=n.n(ue);var se=function(){return console.log("[PdfEditor] render"),r.a.createElement("div",{className:le.a.screenViewport},r.a.createElement(d,null,r.a.createElement(p,null,r.a.createElement(C,null,r.a.createElement("div",{className:le.a.editorArea},r.a.createElement(F,null,(function(e){return r.a.createElement(r.a.Fragment,null,e.isAtReload()?r.a.createElement(ie,{onClick:e.closeDialog}):null,r.a.createElement(D,null,(function(t){return r.a.createElement(P,Object.assign({onLoad:e.openDialog},t))})),r.a.createElement("div",{className:le.a.pdfViewportArea},e.showDialog?r.a.createElement(T,{onLoad:e.onLoad}):null,r.a.createElement(ce,null,(function(e){return r.a.createElement(oe,e)}))))})))))))};var de=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(l,null,r.a.createElement(se,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));U.a.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.1.266/build/pdf.worker.min.js",c.a.render(r.a.createElement(de,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[70,1,2]]]);
//# sourceMappingURL=main.bce750ea.chunk.js.map